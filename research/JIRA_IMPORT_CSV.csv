Summary,Issue Type,Priority,Epic Link,Description,Labels,Sprint
Fix Flutter color API regressions in dream screens,Bug Fix,Critical,Multi-Device Streaming Experience,"Replace deprecated Color.withValues usages in `frontend_flutter/lib/screens/home_screen.dart` and `frontend_flutter/lib/screens/session_screen.dart` with `withOpacity`/theme tokens, keep gradients consistent, and rerun `flutter analyze`.",Week1,Week 1
Repair SessionScreen audio status interpolation,Bug Fix,High,Multi-Device Streaming Experience,"Fix the invalid `'Gentle ${{true: 'looping', false: 'ready'}[_isAudioPlaying]}'` string in `session_screen.dart`, swap to a ternary, and add a widget test so audio state text no longer breaks compilation.",Week1,Week 1
Create Supabase migrations for profiles and sessions,Story,Critical,Database Schema & User Profile Management,"Add SQL migrations under `backend_supabase/` for `profiles`, `rituals`, `sessions`, and `session_assets` tables with primary keys, indexes, and RLS matching the current Flutter onboarding flow.",Week1,Week 1
Add shared config loader for Supabase and backend URLs,Story,High,Database Schema & User Profile Management,"Provide `.env.example` plus runtime config so `frontend_flutter/lib/main.dart`, `story_service.dart`, and `backend_fastapi/app/config.py` pull Supabase URL/keys and BACKEND_URL via `--dart-define`/env vars.",Week1,Week 1
Introduce Supabase client helper in FastAPI,Story,High,Database Schema & User Profile Management,"Create `backend_fastapi/app/supabase_client.py` (or similar) wrapping `supabase-py`, handling service-role auth, and exposing helpers for CRUD on profiles/sessions used inside the API routes.",Week1,Week 1
Persist generated stories to Supabase tables,Story,Critical,Database Schema & User Profile Management,"After `/api/v1/story` succeeds, insert story text, profile context, and asset URLs into Supabase via the new helper, updating `backend_fastapi/app/main.py` + Pydantic schemas.",Week2,Week 2
Make HuggingFace calls async-safe with timeouts,Story,High,Enhanced Story Generation Pipeline,"Wrap `StoryGenerator`, `NarrationGenerator`, and `VisualGenerator` calls in `asyncio.to_thread`, add request timeouts/retries on the `InferenceClient`, and bubble structured errors to FastAPI.",Week2,Week 2
Serve media via Supabase Storage signed URLs,Story,High,Enhanced Story Generation Pipeline,"Upload audio/video/frame files from `backend_fastapi/app/services.py` to Supabase Storage, return signed URLs, and stop serving local `/assets` static mounts.",Week2,Week 2
Improve VisualGenerator scene chunking fallback,Story,Medium,Enhanced Story Generation Pipeline,"Refine `VisualGenerator.create_frames` to evenly map paragraphs to `num_scenes`, truncate captions, and fall back to a placeholder image when HuggingFace image calls fail.",Week2,Week 2
Add PromptBuilder + generator unit tests,Story,Medium,Enhanced Story Generation Pipeline,"Add pytest coverage (e.g., `tests/test_prompting.py`) ensuring `PromptBuilder` enforces brand rules and mocked `StoryGenerator` respects `target_length`/profile context.",Week2,Week 2
Expose GET /api/v1/stories/history,Story,High,User Feedback & Learning System,"Add a paginated `GET /api/v1/stories/history` route that reads prior stories for the authenticated Supabase user using the new helper layer.",Week3,Week 3
Show recent sessions on HomeScreen,Story,Medium,User Feedback & Learning System,"Consume the history endpoint from `HomeScreen`, render a horizontal carousel of recent sessions (thumbnail + theme), and cache offline results.",Week3,Week 3
Sync PreferencesService with Supabase profile,Story,High,User Feedback & Learning System,"Refactor `PreferencesService` to read/write mood, ritual, and preferences from the Supabase `profiles` table (fallback to SharedPreferences) and hydrate inputs on launch.",Week3,Week 3
Add playback error boundary to SessionScreen,Story,Medium,Multi-Device Streaming Experience,"Detect `VideoPlayerController` init failures in `session_screen.dart`, show placeholder art + retry CTA, and guard against null `_chewieController` usage.",Week3,Week 3
Load default prompts/themes from config file,Story,Medium,Enhanced Story Generation Pipeline,"Move featured worlds into a JSON/YAML config (e.g., `backend_fastapi/app/story_presets.json`), load it inside `PromptBuilder`, and expose through an endpoint for Flutter to stay in sync.",Week3,Week 3
Externalize guardrail terms + tone thresholds,Story,High,Trust & Safety Framework,"Load banned terms and tone limits from `config/guardrails.yaml`, allow per-profile overrides, and support hot reload without redeploying FastAPI.",Week4,Week 4
Sanitize narration and visual prompts pre-generation,Story,Critical,Trust & Safety Framework,"Before HuggingFace calls, strip/swap banned phrases, enforce emoji/character whitelist, and log guardrail violations so unsafe prompts return 422 responses.",Week4,Week 4
Retire legacy generate_story.py script,Story,Medium,Enhanced Story Generation Pipeline,"Delete or refactor `backend_fastapi/generate_story.py` so stray decorators are removed and there is a single FastAPI surface area in `app/main.py`.",Week4,Week 4
Add pytest coverage for ContentGuard heuristics,Story,Medium,Trust & Safety Framework,"Write tests for `ContentGuard` overstimulation detection, banned-term matches, and serialized violation payloads to prevent regressions.",Week4,Week 4
Instrument FastAPI logging with request IDs,Story,Medium,Monetization & Launch Readiness,"Add structured logging (middleware or dependency) that stamps request IDs, prompt IDs, and latency metrics in `backend_fastapi/app/main.py` for future observability.",Week4,Week 4
Implement offline audio caching in AudioService,Story,High,Multi-Device Streaming Experience,"Extend `frontend_flutter/lib/services/audio_service.dart` to download narration files to cache (path_provider), expose an offline toggle in `SessionScreen`, and clean up when storage is low.",Week5,Week 5
Add download/share controls for session assets,Story,Medium,Multi-Device Streaming Experience,"In `SessionScreen`, add buttons to download MP4/audio, save frames to gallery, and share via `share_plus`, handling storage permission flows on Android/iOS.",Week5,Week 5
Capture post-session feedback in Flutter UI,Story,Medium,User Feedback & Learning System,"Show a modal after playback to collect rating + mood delta, queue submissions (even offline), and surface errors inline.",Week5,Week 5
Create POST /api/v1/feedback endpoint,Story,High,User Feedback & Learning System,"Add a `/api/v1/feedback` route that validates payloads, logs guardrail context, and stores rows in a new Supabase `session_feedback` table.",Week5,Week 5
Schedule Supabase streak summary job,Story,Medium,Database Schema & User Profile Management,"Author a Supabase scheduled function/edge function plus SQL to recompute nightly streaks into `user_streaks`, checking it into `backend_supabase/`.",Week5,Week 5
Build moderation queue + admin endpoints,Story,High,Trust & Safety Framework,"Create a `moderation_queue` table, wire `ContentGuard` to enqueue violations, and add admin routes to list/resolve items with audit logs.",Week6,Week 6
Add regression harness for story pipeline,Story,Medium,Enhanced Story Generation Pipeline,"Write a pytest/CLI harness that runs ~10 canned prompts through mocked generators to catch drift in tone, length, and scene counts.",Week6,Week 6
Set up GitHub Actions CI for Flutter & FastAPI,Story,High,Monetization & Launch Readiness,"Add `.github/workflows/ci.yml` running `flutter format/analyze/test` plus FastAPI lint/pytest with cached dependencies on every PR.",Week6,Week 6
Add Dockerfile + compose for local stack,Story,Medium,Monetization & Launch Readiness,"Create `backend_fastapi/Dockerfile` and project-level `docker-compose.yml` (API + Supabase + mock HuggingFace) to mirror prod locally.",Week6,Week 6
Load Supabase service key via secrets manager,Story,Medium,Database Schema & User Profile Management,"Update `backend_fastapi/app/config.py` to pull the service-role key from environment/KeyVault (never from repo), document how CI injects it, and fail fast when missing.",Week6,Week 6
Instrument Sentry/analytics across app and API,Story,Medium,Monetization & Launch Readiness,"Integrate Sentry (or Supabase Logflare) in `frontend_flutter/lib/main.dart` and FastAPI middleware so crashes + guardrail hits capture session IDs.",Week7,Week 7
Create Supabase analytics view + ETL script,Story,Medium,Monetization & Launch Readiness,"Add SQL views + a Python ETL script exporting daily DAU, average story count, and persona mix to CSV for monetization tracking.",Week7,Week 7
Run Locust load tests and fix resource leaks,Story,High,Enhanced Story Generation Pipeline,"Use Locust to simulate 200 concurrent `/api/v1/story` requests, monitor CPU/GPU + MoviePy cleanup, and patch any lingering `AudioFileClip`/ImageClip leaks.",Week7,Week 7
Purge expired media assets automatically,Story,Medium,Trust & Safety Framework,"Add a scheduled job (FastAPI task or Supabase function) that deletes storage objects + DB rows older than 7 days to control costs and comply with privacy.",Week8,Week 8
Add Flutter integration_test covering e2e flow,Story,High,Multi-Device Streaming Experience,"Create `integration_test/app_flow_test.dart` that (mock) signs in, generates a story via `StoryService`, opens `SessionScreen`, and asserts playback + feedback UI flows.",Week8,Week 8
Automate fastlane release scripts for mobile stores,Story,High,Monetization & Launch Readiness,"Add fastlane lanes/metadata under `frontend_flutter/ios` and `android` folders, wire them into CI, and document signing for App Store + Play Store releases.",Week8,Week 8
